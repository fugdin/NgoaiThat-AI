# ğŸ“‹ TÃ€I LIá»†U CHI TIáº¾T Há»† THá»NG NGOáº I THáº¤T AI

## ğŸ¯ Tá»”NG QUAN Há»† THá»NG

**TÃªn há»‡ thá»‘ng:** Há»‡ thá»‘ng gá»£i Ã½ thiáº¿t káº¿ ngoáº¡i tháº¥t cÄƒn nhÃ  báº±ng AI  
**Má»¥c Ä‘Ã­ch:** GiÃºp ngÆ°á»i dÃ¹ng táº¡o phÆ°Æ¡ng Ã¡n thiáº¿t káº¿ ngoáº¡i tháº¥t dá»±a trÃªn áº£nh máº«u, áº£nh nhÃ  tháº­t vÃ  yÃªu cáº§u cá»¥ thá»ƒ  
**Äá»‘i tÆ°á»£ng:** NgÆ°á»i dÃ¹ng (User) vÃ  Quáº£n trá»‹ viÃªn (Admin)

---

## ğŸ§© PHÃ‚N RÃƒ CHá»¨C NÄ‚NG Há»† THá»NG

Dá»±a trÃªn yÃªu cáº§u vÃ  thiáº¿t káº¿ má»›i nháº¥t:

| NhÃ³m TÃ­nh NÄƒng | Chá»©c NÄƒng Cá»¥ Thá»ƒ | NgÆ°á»i DÃ¹ng (KhÃ¡ch hÃ ng) | Quáº£n trá»‹ Há»‡ thá»‘ng (Admin) |
| :--- | :--- | :--- | :--- |
| **1. Quáº£n lÃ½ TÃ i khoáº£n & Há»“ sÆ¡** | ÄÄƒng kÃ½ / ÄÄƒng nháº­p | Táº¡o tÃ i khoáº£n báº±ng email, Ä‘Äƒng nháº­p há»‡ thá»‘ng | Xem danh sÃ¡ch tÃ i khoáº£n, phÃ¢n quyá»n (user/admin) |
| | Quáº£n lÃ½ Há»“ sÆ¡ ngÆ°á»i dÃ¹ng | Cáº­p nháº­t diá»‡n tÃ­ch Ä‘áº¥t, loáº¡i nhÃ , phong cÃ¡ch yÃªu thÃ­ch, ngÃ¢n sÃ¡ch | Quáº£n trá»‹ xem/sá»­a thÃ´ng tin há»“ sÆ¡ Ä‘á»ƒ há»— trá»£ tÆ° váº¥n |
| **2. TÆ° váº¥n Ngoáº¡i tháº¥t theo NgÅ© HÃ nh** | Upload áº£nh máº«u | Táº£i áº£nh nhÃ  máº«u cá»§a khÃ¡ch hÃ ng mÃ  há» muá»‘n phong cÃ¡ch vÃ  mÃ u sÆ¡n cá»§a nhÃ  máº«u Ä‘Ã³ | Kiá»ƒm tra dung lÆ°á»£ng áº£nh, Ä‘áº£m báº£o khÃ´ng spam |
| | PhÃ¢n tÃ­ch & Gá»£i Ã½ má»‡nh | Chá»n báº£n má»‡nh (Kim, Má»™c, Thá»§y, Há»a, Thá»•). Há»‡ thá»‘ng tá»± Ä‘á»™ng trÃ­ch xuáº¥t bá»™ tá»« khÃ³a mÃ u sáº¯c tÆ°Æ¡ng sinh. | Cáº¥u hÃ¬nh bá»™ tá»« khÃ³a (Keywords) mÃ u sáº¯c cho tá»«ng má»‡nh Ä‘á»ƒ tá»‘i Æ°u Prompt. |
| | Upload áº£nh máº·t tiá»n | Táº£i áº£nh nhÃ  thÃ´ (nhÃ  chÆ°a tÃ´ mÃ u hiá»‡n táº¡i) cá»§a khÃ¡ch hÃ ng | Kiá»ƒm tra dung lÆ°á»£ng áº£nh, Ä‘áº£m báº£o khÃ´ng spam |
| | Sinh áº£nh tá»« AI | Nháº­n 1 áº£nh gá»£i Ã½ tá»« API AI (Gemini) | Cáº¥u hÃ¬nh API key, giÃ¡m sÃ¡t sá»‘ láº§n gá»i API |
| | LÆ°u áº£nh & quáº£n lÃ½ URL | áº¢nh gá»£i Ã½ Ä‘Æ°á»£c lÆ°u, cÃ³ thá»ƒ táº£i vá» | Quáº£n trá»‹ xem lá»‹ch sá»­ generate, quáº£n lÃ½ Cloudinary |
| **3. ThÆ° viá»‡n Kiáº¿n trÃºc VÃ¹ng miá»n** | KhÃ¡m phÃ¡ máº«u nhÃ  3 miá»n | Xem 10 máº«u nhÃ  Ä‘áº·c trÆ°ng (Báº¯c, Trung, Nam, Ã‚u). Xem mÃ´ táº£ Ä‘áº·c Ä‘iá»ƒm kiáº¿n trÃºc tá»«ng vÃ¹ng. | Cáº­p nháº­t hÃ¬nh áº£nh, mÃ´ táº£ Ä‘áº·c Ä‘iá»ƒm (StyleData) cho 10 máº«u nhÃ  thÆ° viá»‡n. |
| **4. Thiáº¿t káº¿ phá»‘i há»£p (Mix & Match)** | Káº¿t há»£p nhÃ  thÃ´ & ThÆ° viá»‡n | Chá»n nhÃ  thÃ´ + Chá»n nhÃ  máº«u vÃ¹ng miá»n + TÃ¹y chá»‰nh mÃ u bá»™ pháº­n (TÆ°á»ng, MÃ¡i, Cá»™t) -> Sinh áº£nh. | Quáº£n lÃ½ danh má»¥c mÃ£ mÃ u thá»±c táº¿ (HEX) gáº¯n liá»n vá»›i cÃ¡c thÆ°Æ¡ng hiá»‡u sÆ¡n. |
| **8. Quáº£n lÃ½ & GiÃ¡m sÃ¡t há»‡ thá»‘ng** | Quáº£n lÃ½ ngÆ°á»i dÃ¹ng | - | Xem tá»•ng sá»‘ user, thá»‘ng kÃª lÆ°á»£t sinh áº£nh |
| | Quáº£n lÃ½ log | - | GiÃ¡m sÃ¡t log API, sá»‘ láº§n gá»i |
| | BÃ¡o cÃ¡o thá»‘ng kÃª | - | Xem thá»‘ng kÃª: cÃ¡c phong cÃ¡ch vÃ  mÃ u sáº¯c Ä‘Æ°á»£c ngÆ°á»i dÃ¹ng quan tÃ¢m nháº¥t. |
| | GiÃ¡m sÃ¡t tÃ i nguyÃªn | - | Theo dÃµi dung lÆ°á»£ng lÆ°u trá»¯ JSON (ráº¥t nháº¹) vs áº¢nh (náº·ng) Ä‘á»ƒ tá»‘i Æ°u Cloudinary. |

## ğŸ”€ LUá»’NG ÄI Há»† THá»NG (FLOWCHART)

### 1. Luá»“ng Tá»•ng QuÃ¡t
*   **VÃ o Web** -> **ÄÄƒng nháº­p**
    *   Náº¿u chÆ°a cÃ³ tÃ i khoáº£n -> **ÄÄƒng kÃ½** -> Quay láº¡i ÄÄƒng nháº­p.
    *   Náº¿u Ä‘Äƒng nháº­p thÃ nh cÃ´ng -> **Kiá»ƒm tra Quyá»n (Role)**.

### 2. Luá»“ng User (KhÃ¡ch hÃ ng)
*   Sau khi phÃ¢n quyá»n lÃ  **User**, chuyá»ƒn Ä‘áº¿n trang **KhÃ¡m phÃ¡ tÃ­nh nÄƒng**.
*   CÃ¡c chá»©c nÄƒng chÃ­nh:
    *   **CÃ¡ nhÃ¢n**: Xem thÃ´ng tin, **Lá»‹ch sá»­** sinh áº£nh -> **ÄÄƒng xuáº¥t**.
    *   **Quy trÃ¬nh Táº¡o áº£nh (Wizard Flow)**:
        1.  **Trang Táº¡o áº£nh** -> **Upload áº£nh máº«u**.
        2.  **YÃªu cáº§u**: Chá»n/nháº­p yÃªu cáº§u thiáº¿t káº¿ -> PhÃ¢n tÃ­ch.
        3.  **Upload áº£nh nhÃ  cá»§a báº£n thÃ¢n** (Máº·t tiá»n thÃ´).
        4.  **AI Sinh áº£nh**: Há»‡ thá»‘ng xá»­ lÃ½ vÃ  tráº£ vá» káº¿t quáº£.
        5.  **LÆ°u/Quáº£n lÃ½ áº£nh**: Káº¿t quáº£ lÆ°u vÃ o lá»‹ch sá»­ -> **Káº¿t thÃºc**.
    *   **Quy trÃ¬nh ThÆ° viá»‡n Máº«u (Mix & Match)**:
        1.  **Trang ThÆ° viá»‡n máº«u** -> **Lá»±a chá»n áº¢nh trong thÆ° viá»‡n**.
        2.  **Click vÃ o vÃ¹ng cáº§n Ä‘á»•i mÃ u** -> **Chá»n MÃ u** (tá»« báº£ng mÃ u/hÃ£ng sÆ¡n).
        3.  **AI Sinh áº£nh**: Káº¿t há»£p nhÃ  thÃ´ + mÃ u Ä‘Ã£ chá»n.
        4.  **LÆ°u/Quáº£n lÃ½ áº£nh** -> **Káº¿t thÃºc**.

### 3. Luá»“ng Admin (Quáº£n trá»‹ viÃªn)
*   Sau khi phÃ¢n quyá»n lÃ  **Admin**, chuyá»ƒn Ä‘áº¿n **Admin Dashboard**.
*   CÃ¡c chá»©c nÄƒng quáº£n trá»‹:
    *   **Quáº£n lÃ½ ngÆ°á»i dÃ¹ng**: Xem danh sÃ¡ch, sá»­a, xÃ³a, phÃ¢n quyá»n.
    *   **Quáº£n lÃ½ log/giao dá»‹ch**: Xem lá»‹ch sá»­ hoáº¡t Ä‘á»™ng há»‡ thá»‘ng.
    *   **Quáº£n lÃ½ ThÆ° Viá»‡n Máº«u**: Cáº­p nháº­t áº£nh máº«u, StyleData.
    *   **BÃ¡o cÃ¡o thá»‘ng kÃª**: Xem biá»ƒu Ä‘á»“, metrics.
    *   **Quáº£n lÃ½ Danh má»¥c MÃ u & Váº­t liá»‡u**: CRUD mÃ£ mÃ u, hÃ£ng sÆ¡n.
    *   **Quáº£n lÃ½ Prompt cá»§a má»‡nh**: Cáº¥u hÃ¬nh keywords cho ngÅ© hÃ nh.
*   **Chuyá»ƒn sang giao diá»‡n User**: Admin cÃ³ thá»ƒ switch view Ä‘á»ƒ test tÃ­nh nÄƒng User.
*   **Káº¿t thÃºc**: ÄÄƒng xuáº¥t.

---

## ğŸ“Š MODEL CHÃNH (DATABASE)

Há»‡ thá»‘ng sá»­ dá»¥ng **SQL Server** vá»›i 3 báº£ng chÃ­nh:

### 1. **Users** (Báº£ng ngÆ°á»i dÃ¹ng)

```sql
- Id (BIGINT, PRIMARY KEY, IDENTITY)
- Email (NVARCHAR(191), UNIQUE, NOT NULL)
- PasswordHash (NVARCHAR(255), NOT NULL) - Máº­t kháº©u Ä‘Ã£ hash báº±ng bcrypt
- Role (NVARCHAR(20), DEFAULT 'user') - 'user' hoáº·c 'admin'
- CreatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

### 2. **Profiles** (Báº£ng thÃ´ng tin cÃ¡ nhÃ¢n)

```sql
- Id (BIGINT, PRIMARY KEY, IDENTITY)
- UserId (BIGINT, FOREIGN KEY â†’ Users.Id)
- AreaSqm (INT) - Diá»‡n tÃ­ch nhÃ  (mÂ²)
- HouseType (NVARCHAR(100)) - Loáº¡i nhÃ 
- Style (NVARCHAR(200)) - Phong cÃ¡ch yÃªu thÃ­ch
- Budget (NVARCHAR(50)) - NgÃ¢n sÃ¡ch
- UpdatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

### 3. **Generations** (Báº£ng lá»‹ch sá»­ sinh áº£nh)

```sql
- Id (BIGINT, PRIMARY KEY, IDENTITY)
- UserId (BIGINT, FOREIGN KEY â†’ Users.Id)
- InputDesc (NVARCHAR(MAX)) - MÃ´ táº£ Ä‘áº§u vÃ o
- InputImageUrl (NVARCHAR(500)) - URL áº£nh nhÃ  thÃ´ (lÆ°u trÃªn Cloudinary)
- OutputImageUrl (NVARCHAR(500)) - URL áº£nh káº¿t quáº£ (lÆ°u trÃªn Cloudinary)
- Style (NVARCHAR(200)) - Phong cÃ¡ch Ä‘Ã£ chá»n
- Palette (NVARCHAR(200)) - Báº£ng mÃ u
- Seed (BIGINT) - Seed cho random generation (náº¿u cÃ³)
- PromptUsed (NVARCHAR(MAX)) - Prompt Ä‘Ã£ dÃ¹ng Ä‘á»ƒ sinh áº£nh
- CreatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

### 4. **DesignConfigs** (Báº£ng cáº¥u hÃ¬nh phá»‘i mÃ u - Ä‘Æ°á»£c táº¡o Ä‘á»™ng)

```sql
- Id (BIGINT, PRIMARY KEY, IDENTITY)
- GenerationId (BIGINT, FOREIGN KEY â†’ Generations.Id, ON DELETE CASCADE) - LiÃªn káº¿t vá»›i áº£nh gá»‘c
- UserId (BIGINT, FOREIGN KEY â†’ Users.Id) - Chá»§ sá»Ÿ há»¯u báº£n phá»‘i mÃ u
- ConfigJson (NVARCHAR(MAX)) - LÆ°u trá»¯ JSON phá»‘i mÃ u (Vd: {"wall": "#F2F4F0", "roof": "#333333"})
- IsFinal (BIT, DEFAULT 0) - ÄÃ¡nh dáº¥u báº£n phá»‘i chá»‘t Ä‘á»ƒ xuáº¥t bÃ¡o cÃ¡o PDF
- UpdatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

### 5. **ColorPalette** (Báº£ng mÃ u sáº¯c - Ä‘Æ°á»£c táº¡o Ä‘á»™ng)

```sql
- Id (INT, PRIMARY KEY, IDENTITY)
- ColorName (NVARCHAR(100)) - TÃªn thÆ°Æ¡ng máº¡i cá»§a mÃ u (Vd: Tráº¯ng Sá»©, XÃ¡m Ghi)
- HexCode (NVARCHAR(7)) - MÃ£ mÃ u ká»¹ thuáº­t (Vd: #f0f0f0)
- Brand (NVARCHAR(100)) - HÃ£ng sÆ¡n (Vd: Dulux, Jotun)
- Category (NVARCHAR(50)) - PhÃ¢n loáº¡i váº­t liá»‡u hoáº·c cÃ´ng nÄƒng (Vd: SÆ¡n phá»§, Gáº¡ch á»‘p, Má»‡nh Kim)
```
### 6. **ImageMasks** (Dá»¯ liá»‡u phÃ¢n vÃ¹ng AI - Ä‘Æ°á»£c táº¡o Ä‘á»™ng)
```sql
- Id (BIGINT, PRIMARY KEY, IDENTITY)
- GenerationId (BIGINT, FOREIGN KEY â†’ Generations.Id, ON DELETE CASCADE)
- Label (NVARCHAR(100)) - TÃªn vÃ¹ng nháº­n diá»‡n (Vd: wall, roof, window)
- PolygonData (NVARCHAR(MAX)) - Máº£ng tá»a Ä‘á»™ JSON (Vd: [[x1,y1], [x2,y2]...])
- CreatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

### 7. **RegionalLibrary** (ThÆ° viá»‡n máº«u nhÃ  vÃ¹ng miá»n)

```sql
- Id (INT, PRIMARY KEY, IDENTITY)
- RegionName (NVARCHAR(50)) - TÃªn vÃ¹ng miá»n (Báº¯c, Trung, Nam, Ã‚u)
- ImageUrl (NVARCHAR(500)) - URL áº£nh máº«u nhÃ  (lÆ°u trÃªn Cloudinary)
- StyleData (NVARCHAR(MAX)) - JSON mÃ´ táº£ Ä‘áº·c Ä‘iá»ƒm kiáº¿n trÃºc
- Description (NVARCHAR(MAX)) - MÃ´ táº£ chi tiáº¿t vá» máº«u nhÃ 
- CreatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

### 8. **ElementMenh** (Cáº¥u hÃ¬nh mÃ u theo NgÅ© HÃ nh - Dá»± kiáº¿n)

```sql
- Id (INT, PRIMARY KEY, IDENTITY)
- MenhName (NVARCHAR(50)) - TÃªn má»‡nh (Kim, Má»™c, Thá»§y, Há»a, Thá»•)
- Keywords (NVARCHAR(MAX)) - CÃ¡c tá»« khÃ³a mÃ u sáº¯c tÆ°Æ¡ng sinh (JSON array)
- PromptTemplate (NVARCHAR(MAX)) - Template prompt cho AI
- CreatedAt (DATETIME2, DEFAULT SYSDATETIME())
```

---

## ğŸ› ï¸ TECH STACK

### **Backend**

- **Framework:** Node.js + Express.js
- **Database Driver:** mssql (SQL Server)
- **Authentication:** JWT (jsonwebtoken)
- **Password Hashing:** bcrypt
- **File Upload:** multer, express-fileupload
- **HTTP Client:** axios
- **Image Processing:** Cloudinary SDK
- **AI Services:**
  - Google Gemini AI (@google/generative-ai, @google/genai)(má»™t cÃ¡i free dÃ¹ng cho text, má»™t cÃ¡i tÃ­nh phÃ­ dÃ¹ng Ä‘á»ƒ sinh áº£nh)
  - Stability AI API
  - Replicate API
  - Hugging Face Inference API
- **Logging:** morgan
- **PDF Generation:** pdfkit
- **Environment:** dotenv

### **Database**

- **Há»‡ quáº£n trá»‹:** Microsoft SQL Server
- **Connection Pool:** mssql ConnectionPool
- **Authentication:** Há»— trá»£ cáº£ SQL Authentication vÃ  Windows Authentication (NTLM)

### **Frontend**

- **Framework:** React 19.1.1
- **Build Tool:** Vite 7.1.7
- **Styling:** Tailwind CSS 4.1.13
- **State Management:** React Hooks (useState, useEffect, custom hooks)
- **HTTP Client:** Fetch API (native)

### **Image Storage**

- **Service:** Cloudinary
- **Upload Method:** Stream upload tá»« buffer
- **Folders:**
  - `exterior_ai/samples` - áº¢nh máº«u (bao gá»“m áº£nh thÆ° viá»‡n vÃ¹ng miá»n)
  - `exterior_ai/houses` - áº¢nh nhÃ  thÃ´
  - `exterior_ai/outputs` - áº¢nh káº¿t quáº£

---

## ğŸ“ Cáº¤U TRÃšC THÆ¯ Má»¤C

### **Backend** (`backend/`)

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.js                    # Cáº¥u hÃ¬nh Express app, routes, middlewares
â”‚   â”œâ”€â”€ server.js                 # Entry point, khá»Ÿi Ä‘á»™ng server
â”‚   â”œâ”€â”€ db.js                     # Quáº£n lÃ½ connection pool SQL Server
â”‚   â”œâ”€â”€ middlewares/              # CÃ¡c middleware
â”‚   â”‚   â”œâ”€â”€ auth.js               # JWT authentication middleware
â”‚   â”‚   â”œâ”€â”€ isAdmin.js            # Kiá»ƒm tra quyá»n admin
â”‚   â”‚   â”œâ”€â”€ error.js              # Error handler
â”‚   â”‚   â”œâ”€â”€ respond.js            # Chuáº©n hÃ³a response format
â”‚   â”‚   â”œâ”€â”€ activityLogger.js     # Log hoáº¡t Ä‘á»™ng
â”‚   â”‚   â””â”€â”€ asyncHandler.js       # Wrapper xá»­ lÃ½ async errors
â”‚   â”œâ”€â”€ routes/                   # API routes
â”‚   â”‚   â”œâ”€â”€ wizard.js             # Wizard flow (upload-sample, generate-style, generate-final)
â”‚   â”‚   â”œâ”€â”€ users.js              # Authentication (register, login, list users)
â”‚   â”‚   â”œâ”€â”€ histories.js          # Lá»‹ch sá»­ sinh áº£nh
â”‚   â”‚   â”œâ”€â”€ admin.js              # Admin APIs (stats, users, generations, library)
â”‚   â”‚   â”œâ”€â”€ library.js            # [Má»šI] Public API láº¥y thÆ° viá»‡n vÃ¹ng miá»n
â”‚   â”‚   â”œâ”€â”€ designs.js            # LÆ°u/láº¥y cáº¥u hÃ¬nh phá»‘i mÃ u
â”‚   â”‚   â””â”€â”€ colors.js             # Láº¥y danh sÃ¡ch mÃ u
â”‚   â””â”€â”€ services/                 # Business logic services
â”‚       â”œâ”€â”€ cloud.js              # Cloudinary upload service
â”‚       â”œâ”€â”€ external-ai.js        # AI services (Gemini, Stability, Replicate, HuggingFace)
â”‚       â”œâ”€â”€ gemini.js             # Gemini AI service (náº¿u cÃ³)
â”‚       â”œâ”€â”€ aws.js                # [Má»šI] AWS services (S3, náº¿u dÃ¹ng)
â”‚       â”œâ”€â”€ designService.js      # Service quáº£n lÃ½ DesignConfigs
â”‚       â”œâ”€â”€ colorService.js       # Service quáº£n lÃ½ ColorPalette
â”‚       â””â”€â”€ adminSeeder.js        # Táº¡o tÃ i khoáº£n admin máº·c Ä‘á»‹nh
â”œâ”€â”€ package.json
â””â”€â”€ .env                          # Environment variables
```

### **Frontend** (`frontend/`)

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.jsx                  # Entry point React app
â”‚   â”œâ”€â”€ App.jsx                   # Main app component, routing logic
â”‚   â”œâ”€â”€ App.css                   # Global styles
â”‚   â”œâ”€â”€ index.css                 # Tailwind CSS imports
â”‚   â”œâ”€â”€ api/                      # API client functions
â”‚   â”‚   â”œâ”€â”€ auth.js               # Authentication APIs
â”‚   â”‚   â”œâ”€â”€ wizard.js             # Wizard flow APIs
â”‚   â”‚   â””â”€â”€ admin.js              # Admin APIs (users, generations, library)
â”‚   â”œâ”€â”€ components/               # React components
â”‚   â”‚   â”œâ”€â”€ LoginPage.jsx         # Trang Ä‘Äƒng nháº­p
â”‚   â”‚   â”œâ”€â”€ RegisterPage.jsx      # Trang Ä‘Äƒng kÃ½
â”‚   â”‚   â”œâ”€â”€ UploadSampleStep.jsx  # BÆ°á»›c 1: Upload áº£nh máº«u
â”‚   â”‚   â”œâ”€â”€ SelectRequirementsStep.jsx # BÆ°á»›c 2: Chá»n yÃªu cáº§u
â”‚   â”‚   â”œâ”€â”€ UploadHouseStep.jsx    # BÆ°á»›c 3: Upload áº£nh nhÃ  tháº­t
â”‚   â”‚   â”œâ”€â”€ ResultStep.jsx        # BÆ°á»›c 4: Hiá»ƒn thá»‹ káº¿t quáº£
â”‚   â”‚   â”œâ”€â”€ WizardNavigation.jsx  # Navigation bar cho wizard
â”‚   â”‚   â”œâ”€â”€ HistoryViewer.jsx     # Xem lá»‹ch sá»­ sinh áº£nh
â”‚   â”‚   â”œâ”€â”€ ProfilePage.jsx       # Trang cÃ¡ nhÃ¢n
â”‚   â”‚   â”œâ”€â”€ AdminDashboard.jsx    # Dashboard admin
â”‚   â”‚   â”œâ”€â”€ AdminDashboardPage.jsx # Trang admin dashboard
â”‚   â”‚   â”œâ”€â”€ AdminLayout.jsx       # Layout cho admin pages
â”‚   â”‚   â”œâ”€â”€ AdminUserManagement.jsx # Quáº£n lÃ½ users (admin)
â”‚   â”‚   â”œâ”€â”€ AdminLibraryManager.jsx # [Má»šI] Quáº£n lÃ½ thÆ° viá»‡n máº«u nhÃ  vÃ¹ng miá»n
â”‚   â”‚   â””â”€â”€ ToastList.jsx         # Toast notifications
â”‚   â”œâ”€â”€ hooks/                    # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useWizardFlow.js      # Hook quáº£n lÃ½ wizard flow
â”‚   â”‚   â”œâ”€â”€ useHistoryManager.js  # Hook quáº£n lÃ½ lá»‹ch sá»­
â”‚   â”‚   â”œâ”€â”€ useAdminUsers.js      # Hook quáº£n lÃ½ users (admin)
â”‚   â”‚   â””â”€â”€ useToasts.js          # Hook quáº£n lÃ½ toast notifications
â”‚   â””â”€â”€ utils/                    # Utility functions
â”‚       â””â”€â”€ wizard.js             # Helper functions cho wizard
â”œâ”€â”€ public/                       # Static assets
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.js                # Vite configuration
```

### **Tests** (`tests-e2e/`)

```
tests-e2e/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ setup.js                  # Test setup
â”‚   â”œâ”€â”€ helpers.js                # Test helper functions
â”‚   â”œâ”€â”€ auth.test.js              # Test authentication
â”‚   â”œâ”€â”€ wizard-ai.test.js         # Test wizard AI flow
â”‚   â”œâ”€â”€ wizard-navigation.test.js  # Test wizard navigation
â”‚   â”œâ”€â”€ wizard-requirements.test.js # Test requirements step
â”‚   â”œâ”€â”€ upload-house.test.js       # Test upload house
â”‚   â”œâ”€â”€ history.test.js            # Test history
â”‚   â”œâ”€â”€ profile.test.js            # Test profile
â”‚   â”œâ”€â”€ admin.test.js              # Test admin functions
â”‚   â””â”€â”€ security.test.js           # Test security
â””â”€â”€ package.json
```

### **Docs** (`docs/`)

```
docs/
â”œâ”€â”€ db-schema.sql                 # Database schema
â”œâ”€â”€ implementation-summary.md     # TÃ³m táº¯t implementation
â”œâ”€â”€ backend_mockapi/              # Mock API documentation
â””â”€â”€ HE_THONG_CHI_TIET.md          # File nÃ y
```

---

## ğŸ”‘ VAI TRÃ’ CÃC FILE Äáº¶C BIá»†T

### **Backend**

#### `db.js`

- **Vai trÃ²:** Quáº£n lÃ½ connection pool káº¿t ná»‘i SQL Server
- **Chá»©c nÄƒng:**
  - Táº¡o singleton connection pool
  - Há»— trá»£ cáº£ SQL Authentication vÃ  Windows Authentication (NTLM)
  - Export `getPool()` Ä‘á»ƒ láº¥y pool instance
  - Export `testDb()` Ä‘á»ƒ kiá»ƒm tra káº¿t ná»‘i
  - Export `sql` Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c kiá»ƒu dá»¯ liá»‡u SQL

#### `middlewares/auth.js`

- **Vai trÃ²:** Middleware xÃ¡c thá»±c JWT token
- **Chá»©c nÄƒng:**
  - Kiá»ƒm tra header `Authorization: Bearer <token>`
  - Verify JWT token vá»›i `JWT_SECRET`
  - Láº¥y thÃ´ng tin user tá»« database
  - Gáº¯n `req.user` vá»›i thÃ´ng tin user (id, email, role)
  - Tráº£ 401 náº¿u token khÃ´ng há»£p lá»‡ hoáº·c user khÃ´ng tá»“n táº¡i

#### `middlewares/isAdmin.js`

- **Vai trÃ²:** Middleware kiá»ƒm tra quyá»n admin
- **Chá»©c nÄƒng:**
  - Kiá»ƒm tra `req.user.role === 'admin'`
  - Tráº£ 403 náº¿u khÃ´ng pháº£i admin
  - Pháº£i Ä‘áº·t sau middleware `auth`

#### `middlewares/respond.js`

- **Vai trÃ²:** Chuáº©n hÃ³a format response
- **Chá»©c nÄƒng:**
  - ThÃªm `res.ok(data, message, status)` Ä‘á»ƒ tráº£ vá» success response
  - ThÃªm `res.err(message, status, extra)` Ä‘á»ƒ tráº£ vá» error response
  - Format: `{ ok: true/false, data: ..., message: ... }`

#### `middlewares/error.js`

- **Vai trÃ²:** Global error handler
- **Chá»©c nÄƒng:**
  - Báº¯t táº¥t cáº£ lá»—i khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½
  - Log lá»—i ra console
  - Tráº£ vá» 500 vá»›i message "Internal Server Error"

#### `middlewares/asyncHandler.js`

- **Vai trÃ²:** Wrapper xá»­ lÃ½ async errors
- **Chá»©c nÄƒng:**
  - Bá»c async route handlers
  - Tá»± Ä‘á»™ng catch errors vÃ  tráº£ vá» 500 response
  - GiÃºp code gá»n hÆ¡n, khÃ´ng cáº§n try-catch trong má»—i route

#### `services/cloud.js`

- **Vai trÃ²:** Service upload áº£nh lÃªn Cloudinary
- **Chá»©c nÄƒng:**
  - `uploadBufferToCloudinary(buffer, folder)` - Upload buffer lÃªn Cloudinary
  - Sá»­ dá»¥ng stream upload
  - Tráº£ vá» object chá»©a `secure_url` vÃ  cÃ¡c metadata

#### `services/external-ai.js`

- **Vai trÃ²:** Service tÃ­ch há»£p cÃ¡c AI services Ä‘á»ƒ phÃ¢n tÃ­ch vÃ  táº¡o áº£nh
- **Chá»©c nÄƒng:**
  - `analyzeImage()` - PhÃ¢n tÃ­ch áº£nh báº±ng Google Gemini
  - `generateImageExternal()` - Táº¡o áº£nh tá»± Ä‘á»™ng chá»n service
  - `generateImageFromThreeServices()` - Táº¡o áº£nh tá»« nhiá»u services (Gemini, Stability, Replicate, HuggingFace)
  - `generateImageFromImages()` - Image-to-image generation
  - Há»— trá»£ fallback náº¿u service nÃ y fail thÃ¬ thá»­ service khÃ¡c

#### `services/adminSeeder.js`

- **Vai trÃ²:** Tá»± Ä‘á»™ng táº¡o tÃ i khoáº£n admin máº·c Ä‘á»‹nh khi server khá»Ÿi Ä‘á»™ng
- **Chá»©c nÄƒng:**
  - Kiá»ƒm tra xem Ä‘Ã£ cÃ³ admin chÆ°a
  - Náº¿u chÆ°a cÃ³, táº¡o admin vá»›i email/password tá»« env
  - Náº¿u cÃ³ nhÆ°ng role khÃ´ng pháº£i admin, cáº­p nháº­t role
  - Máº·c Ä‘á»‹nh: `admin@ngoai-that.ai` / `Admin@123456`

### **Frontend**

#### `api/auth.js`

- **Vai trÃ²:** API client cho authentication
- **Chá»©c nÄƒng:**
  - `registerUser()` - ÄÄƒng kÃ½ tÃ i khoáº£n má»›i
  - `loginUser()` - ÄÄƒng nháº­p, tráº£ vá» token vÃ  user info

#### `api/wizard.js`

- **Vai trÃ²:** API client cho wizard flow
- **Chá»©c nÄƒng:**
  - `uploadSample()` - Upload áº£nh máº«u
  - `generateStyle()` - Gá»­i yÃªu cáº§u phong cÃ¡ch
  - `generateFinal()` - Upload áº£nh nhÃ  tháº­t vÃ  sinh áº£nh káº¿t quáº£
  - `getHistories()` - Láº¥y lá»‹ch sá»­ sinh áº£nh

#### `api/admin.js` - [Má»šI/Cáº¬P NHáº¬T]

- **Vai trÃ²:** API client cho cÃ¡c chá»©c nÄƒng admin
- **Chá»©c nÄƒng:**
  - **User Management:**
    - `fetchAdminUsers()` - Láº¥y danh sÃ¡ch users (cÃ³ phÃ¢n trang, filter)
    - `createAdminUser()` - Táº¡o user má»›i
    - `updateAdminUser()` - Cáº­p nháº­t thÃ´ng tin user
    - `deleteAdminUser()` - XÃ³a user
  - **Generation Management:**
    - `fetchAdminStats()` - Láº¥y thá»‘ng kÃª tá»•ng quan
    - `fetchAdminGenerations()` - Láº¥y danh sÃ¡ch lÆ°á»£t sinh áº£nh
    - `fetchGenerationsByUser()` - Thá»‘ng kÃª lÆ°á»£t sinh theo user
    - `deleteAdminGeneration()` - XÃ³a lÆ°á»£t sinh áº£nh
  - **Library Management (Má»šI):**
    - `createLibraryItem(formData, token)` - ThÃªm máº«u nhÃ  vÃ o thÆ° viá»‡n
    - `fetchAdminLibrary(token)` - Láº¥y danh sÃ¡ch thÆ° viá»‡n vÃ¹ng miá»n
    - `updateLibraryItem(id, formData, token)` - Cáº­p nháº­t máº«u nhÃ 
    - `deleteLibraryItem(id, token)` - XÃ³a máº«u nhÃ 

#### `hooks/useWizardFlow.js`

- **Vai trÃ²:** Custom hook quáº£n lÃ½ state vÃ  flow cá»§a wizard
- **Chá»©c nÄƒng:**
  - Quáº£n lÃ½ step hiá»‡n táº¡i
  - LÆ°u trá»¯ data qua cÃ¡c bÆ°á»›c (tempId, sample, requirements, results)
  - Xá»­ lÃ½ navigation giá»¯a cÃ¡c bÆ°á»›c

---

## ğŸ“¡ CHI TIáº¾T API ROUTES

### **1. File: `wizard.js`** (`/api/*`)

#### **POST `/api/upload-sample`**

- **MÃ´ táº£:** Upload áº£nh máº«u vÃ  phÃ¢n tÃ­ch báº±ng AI
- **Authentication:** KhÃ´ng cáº§n
- **Request:**
  - Method: `POST`
  - Content-Type: `multipart/form-data`
  - Body: `{ sample: File }`
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "tempId": "uuid-string",
      "aiSummary": "JSON string phÃ¢n tÃ­ch tá»« AI",
      "sampleImageUrl": "https://cloudinary.com/...",
      "sampleImageBuffer": Buffer,
      "sampleMimeType": "image/jpeg"
    }
  }
  ```
- **Lá»—i:**
  ```json
  {
    "ok": false,
    "message": "Thiáº¿u file sample",
    "detail": "..."
  }
  ```

#### **POST `/api/generate-style`**

- **MÃ´ táº£:** LÆ°u yÃªu cáº§u phong cÃ¡ch thiáº¿t káº¿ (khÃ´ng gá»i AI)
- **Authentication:** KhÃ´ng cáº§n
- **Request:**
  - Method: `POST`
  - Content-Type: `application/json`
  - Body:
    ```json
    {
      "tempId": "uuid-string",
      "requirements": {
        "style": "Modern",
        "colorPalette": "cream white with wooden accents",
        "decorItems": "wooden slats, wall lamps",
        "aiSuggestions": "prioritize natural lighting"
      }
    }
    ```
- **Response:**
  ```json
  {
    "ok": true,
    "message": "ÄÃ£ lÆ°u yÃªu cáº§u thiáº¿t káº¿ thÃ nh cÃ´ng"
  }
  ```

#### **POST `/api/generate-final`**

- **MÃ´ táº£:** Upload áº£nh nhÃ  tháº­t vÃ  sinh áº£nh káº¿t quáº£ báº±ng AI
- **Authentication:** Cáº§n (JWT Bearer token)
- **Request:**
  - Method: `POST`
  - Content-Type: `multipart/form-data`
  - Headers: `Authorization: Bearer <token>`
  - Body:
    ```
    tempId: "uuid-string"
    house: File
    ```
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "inputHouse": "https://cloudinary.com/houses/...",
      "outputImages": {
        "single": "https://cloudinary.com/outputs/...",
        "stability": "https://cloudinary.com/outputs/...",
        "replicate": "https://cloudinary.com/outputs/...",
        "huggingface": "https://cloudinary.com/outputs/..."
      },
      "outputImage": "https://cloudinary.com/outputs/..."
    }
  }
  ```
- **Lá»—i:**
  ```json
  {
    "ok": false,
    "message": "Lá»—i sinh áº£nh báº±ng External AI Services",
    "detail": "..."
  }
  ```

---

### **2. File: `users.js`** (`/api/users/*`)

#### **GET `/api/users`**

- **MÃ´ táº£:** Láº¥y danh sÃ¡ch users (cÃ³ phÃ¢n trang, tÃ¬m kiáº¿m, lá»c role)
- **Authentication:** KhÃ´ng cáº§n (nhÆ°ng nÃªn cÃ³ Ä‘á»ƒ báº£o máº­t)
- **Query Parameters:**
  - `page` (default: 1)
  - `pageSize` (default: 20, max: 100)
  - `search` - TÃ¬m theo email
  - `role` - Lá»c theo role ('user', 'admin', 'all')
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "page": 1,
      "pageSize": 20,
      "total": 100,
      "roleSummary": {
        "user": 95,
        "admin": 5
      },
      "items": [
        {
          "Id": 1,
          "Email": "user@example.com",
          "Role": "user",
          "CreatedAt": "2024-01-01T00:00:00Z",
          "GenerationCount": 10,
          "LastGenerationAt": "2024-01-15T00:00:00Z"
        }
      ]
    }
  }
  ```

#### **POST `/api/users/register`**

- **MÃ´ táº£:** ÄÄƒng kÃ½ tÃ i khoáº£n má»›i
- **Authentication:** KhÃ´ng cáº§n
- **Request:**
  ```json
  {
    "email": "user@example.com",
    "password": "password123"
  }
  ```
- **Response:**
  ```json
  {
    "ok": true,
    "message": "ÄÄƒng kÃ½ thÃ nh cÃ´ng!"
  }
  ```

#### **POST `/api/users/login`**

- **MÃ´ táº£:** ÄÄƒng nháº­p vÃ  nháº­n JWT token
- **Authentication:** KhÃ´ng cáº§n
- **Request:**
  ```json
  {
    "email": "user@example.com",
    "password": "password123"
  }
  ```
- **Response:**
  ```json
  {
    "ok": true,
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "email": "user@example.com",
      "role": "user"
    }
  }
  ```

---

### **3. File: `histories.js`** (`/api/histories/*`)

#### **GET `/api/histories/histories`**

- **MÃ´ táº£:** Láº¥y lá»‹ch sá»­ sinh áº£nh cá»§a user hiá»‡n táº¡i
- **Authentication:** Cáº§n (JWT Bearer token)
- **Query Parameters:**
  - `page` (default: 1)
  - `pageSize` (default: 12, max: 50)
  - `userId` (optional, nhÆ°ng sáº½ bá»‹ override bá»Ÿi token)
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "page": 1,
      "pageSize": 12,
      "total": 50,
      "items": [
        {
          "Id": 1,
          "UserId": 1,
          "InputImageUrl": "https://cloudinary.com/houses/...",
          "OutputImageUrl": "https://cloudinary.com/outputs/...",
          "Style": "Modern",
          "Palette": "cream white",
          "PromptUsed": "...",
          "CreatedAt": "2024-01-01T00:00:00Z"
        }
      ]
    }
  }
  ```

---

### **4. File: `admin.js`** (`/api/admin/*`)

**Táº¥t cáº£ routes trong file nÃ y Ä‘á»u yÃªu cáº§u:**

- Authentication: Cáº§n (JWT Bearer token)
- Authorization: Pháº£i lÃ  admin (middleware `isAdmin`)

#### **GET `/api/admin/stats`**

- **MÃ´ táº£:** Thá»‘ng kÃª tá»•ng quan há»‡ thá»‘ng
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "totalUsers": 100,
      "totalGenerations": 500,
      "todayGenerations": 10,
      "topStyles": [
        { "Style": "Modern", "count": 200 },
        { "Style": "Classic", "count": 150 }
      ],
      "topActiveUsers": [
        {
          "UserId": 1,
          "Email": "user@example.com",
          "totalGenerations": 50
        }
      ]
    }
  }
  ```

#### **GET `/api/admin/users`**

- **MÃ´ táº£:** Danh sÃ¡ch users (giá»‘ng `/api/users` nhÆ°ng cÃ³ thÃªm quyá»n admin)
- **Query Parameters:** Giá»‘ng `/api/users`
- **Response:** Giá»‘ng `/api/users`

#### **POST `/api/admin/users`**

- **MÃ´ táº£:** Táº¡o user má»›i (admin)
- **Request:**
  ```json
  {
    "email": "newuser@example.com",
    "password": "password123",
    "role": "user"
  }
  ```
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "user": {
        "Id": 101,
        "Email": "newuser@example.com",
        "Role": "user",
        "CreatedAt": "2024-01-01T00:00:00Z"
      }
    }
  }
  ```

#### **PATCH `/api/admin/users/:id/role`**

- **MÃ´ táº£:** Cáº­p nháº­t role cá»§a user
- **Request:**
  ```json
  {
    "role": "admin"
  }
  ```
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "user": {
        "Id": 1,
        "Email": "user@example.com",
        "Role": "admin",
        "CreatedAt": "2024-01-01T00:00:00Z"
      }
    }
  }
  ```

#### **PUT `/api/admin/users/:id`**

- **MÃ´ táº£:** Cáº­p nháº­t email/role/password cá»§a user
- **Request:**
  ```json
  {
    "email": "newemail@example.com",
    "role": "admin",
    "password": "newpassword123"
  }
  ```
- **Response:** Giá»‘ng PATCH

#### **DELETE `/api/admin/users/:id`**

- **MÃ´ táº£:** XÃ³a user
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "deleted": 1
    }
  }
  ```

#### **GET `/api/admin/generations`**

- **MÃ´ táº£:** Danh sÃ¡ch lÆ°á»£t sinh áº£nh (cÃ³ filter)
- **Query Parameters:**
  - `page`, `pageSize`
  - `userId` - Lá»c theo user
  - `style` - Lá»c theo phong cÃ¡ch
  - `from` - Tá»« ngÃ y (ISO string)
  - `to` - Äáº¿n ngÃ y (ISO string)
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "page": 1,
      "pageSize": 20,
      "total": 500,
      "items": [
        {
          "Id": 1,
          "UserId": 1,
          "Email": "user@example.com",
          "InputImageUrl": "...",
          "OutputImageUrl": "...",
          "Style": "Modern",
          "CreatedAt": "2024-01-01T00:00:00Z"
        }
      ]
    }
  }
  ```

#### **GET `/api/admin/generations/:id`**

- **MÃ´ táº£:** Chi tiáº¿t 1 lÆ°á»£t sinh áº£nh
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "item": {
        "Id": 1,
        "UserId": 1,
        "Email": "user@example.com",
        "InputImageUrl": "...",
        "OutputImageUrl": "...",
        "Style": "Modern",
        "PromptUsed": "...",
        "CreatedAt": "2024-01-01T00:00:00Z"
      }
    }
  }
  ```

#### **DELETE `/api/admin/generations/:id`**

- **MÃ´ táº£:** XÃ³a 1 lÆ°á»£t sinh áº£nh
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "deleted": 1
    }
  }
  ```

#### **GET `/api/admin/generations/:id/export-pdf`**

- **MÃ´ táº£:** Xuáº¥t PDF cho 1 lÆ°á»£t sinh áº£nh
- **Response:** PDF file (Content-Type: application/pdf)

#### **GET `/api/admin/generations/by-user`**

- **MÃ´ táº£:** Tá»•ng há»£p lÆ°á»£t sinh áº£nh theo user
- **Query Parameters:** `page`, `pageSize`, `search`
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "page": 1,
      "pageSize": 5,
      "total": 20,
      "items": [
        {
          "UserId": 1,
          "Email": "user@example.com",
          "Role": "user",
          "GenerationCount": 50,
          "LastGenerationAt": "2024-01-15T00:00:00Z"
        }
      ]
    }
  }
  ```

---

### **5. File: `designs.js`** (`/api/visualizer/*`)

#### **POST `/api/visualizer/save`**

- **MÃ´ táº£:** LÆ°u cáº¥u hÃ¬nh phá»‘i mÃ u cho 1 generation
- **Authentication:** Cáº§n (JWT Bearer token)
- **Request:**
  ```json
  {
    "generationId": 1,
    "configJson": {
      "walls": { "color": "#FFFFFF", "material": "paint" },
      "roof": { "color": "#CCCCCC", "material": "tile" }
    }
  }
  ```
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "message": "ÄÃ£ lÆ°u báº£n phá»‘i mÃ u thÃ nh cÃ´ng"
    }
  }
  ```

#### **GET `/api/visualizer/:generationId`**

- **MÃ´ táº£:** Láº¥y cáº¥u hÃ¬nh phá»‘i mÃ u Ä‘Ã£ lÆ°u
- **Authentication:** Cáº§n (JWT Bearer token)
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "config": {
        "walls": { "color": "#FFFFFF", "material": "paint" },
        "roof": { "color": "#CCCCCC", "material": "tile" }
      }
    }
  }
  ```
- **Náº¿u chÆ°a cÃ³:**
  ```json
  {
    "ok": true,
    "data": {
      "config": null
    }
  }
  ```

---

### **6. File: `colors.js`** (`/api/colors/*`)

#### **GET `/api/colors`**

- **MÃ´ táº£:** Láº¥y danh sÃ¡ch mÃ u sáº¯c
- **Authentication:** KhÃ´ng cáº§n
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "colors": [
        {
          "Id": 1,
          "Brand": "Dulux",
          "ColorName": "Pure White",
          "ColorCode": "#FFFFFF"
        }
      ]
    }
  }
  ```

---

### **7. File: `library.js`** (`/api/library/*`) - [Má»šI]

#### **GET `/api/library/regions`**

- **MÃ´ táº£:** Láº¥y danh sÃ¡ch máº«u nhÃ  thÆ° viá»‡n vÃ¹ng miá»n (Public API)
- **Authentication:** KhÃ´ng cáº§n
- **Response:**
  ```json
  {
    "ok": true,
    "data": [
      {
        "Id": 1,
        "RegionName": "Báº¯c",
        "ImageUrl": "https://cloudinary.com/samples/...",
        "StyleData": "{\"features\": [\"MÃ¡i ngÃ³i Ä‘á»\", \"Cá»­a gá»—\"]}",
        "Description": "NhÃ  truyá»n thá»‘ng miá»n Báº¯c vá»›i mÃ¡i ngÃ³i Ä‘á»...",
        "CreatedAt": "2024-01-01T00:00:00Z"
      }
    ]
  }
  ```

---

### **8. Admin Library APIs** (`/api/admin/library/*`) - [Má»šI]

**Táº¥t cáº£ routes trong pháº§n nÃ y Ä‘á»u yÃªu cáº§u:**
- Authentication: Cáº§n (JWT Bearer token)
- Authorization: Pháº£i lÃ  admin (middleware `isAdmin`)

#### **POST `/api/admin/library`**

- **MÃ´ táº£:** ThÃªm máº«u nhÃ  má»›i vÃ o thÆ° viá»‡n vÃ¹ng miá»n
- **Request:**
  - Method: `POST`
  - Content-Type: `multipart/form-data`
  - Body:
    ```
    regionName: "Báº¯c" | "Trung" | "Nam" | "Ã‚u"
    styleData: "{\"features\": [...]}" (JSON string)
    description: "MÃ´ táº£ chi tiáº¿t..."
    image: File (áº£nh máº«u nhÃ )
    ```
- **Response:**
  ```json
  {
    "ok": true,
    "message": "ÄÃ£ thÃªm máº«u nhÃ  vÃ o thÆ° viá»‡n thÃ nh cÃ´ng",
    "imageUrl": "https://cloudinary.com/samples/..."
  }
  ```

#### **GET `/api/admin/library`**

- **MÃ´ táº£:** Láº¥y danh sÃ¡ch táº¥t cáº£ máº«u nhÃ  (Admin)
- **Response:**
  ```json
  {
    "ok": true,
    "items": [
      {
        "Id": 1,
        "RegionName": "Báº¯c",
        "ImageUrl": "https://...",
        "StyleData": "...",
        "Description": "...",
        "CreatedAt": "2024-01-01T00:00:00Z"
      }
    ]
  }
  ```

#### **PUT `/api/admin/library/:id`**

- **MÃ´ táº£:** Cáº­p nháº­t thÃ´ng tin máº«u nhÃ 
- **Request:**
  - Method: `PUT`
  - Content-Type: `multipart/form-data`
  - Body:
    ```
    regionName: "Báº¯c" (optional)
    styleData: "..." (optional)
    description: "..." (optional)
    image: File (optional - náº¿u muá»‘n thay áº£nh má»›i)
    ```
- **Response:**
  ```json
  {
    "ok": true,
    "message": "ÄÃ£ cáº­p nháº­t máº«u nhÃ  thÃ nh cÃ´ng",
    "item": { ... }
  }
  ```

#### **DELETE `/api/admin/library/:id`**

- **MÃ´ táº£:** XÃ³a máº«u nhÃ  khá»i thÆ° viá»‡n
- **Response:**
  ```json
  {
    "ok": true,
    "deleted": 1
  }
  ```

---

### **7. Health Check**

#### **GET `/health`**

- **MÃ´ táº£:** Kiá»ƒm tra tráº¡ng thÃ¡i server vÃ  database
- **Response:**
  ```json
  {
    "ok": true,
    "data": {
      "time": "2024-01-01T00:00:00Z",
      "ok": true
    }
  }
  ```

---

## ğŸ”„ Cáº¤U TRÃšC REQUEST/RESPONSE CHUáº¨N

### **Success Response**

```json
{
  "ok": true,
  "data": { ... },
  "message": "ThÃ´ng bÃ¡o thÃ nh cÃ´ng (optional)"
}
```

### **Error Response**

```json
{
  "ok": false,
  "message": "MÃ´ táº£ lá»—i",
  "detail": "Chi tiáº¿t lá»—i (optional)"
}
```

### **Pagination Response**

```json
{
  "ok": true,
  "data": {
    "page": 1,
    "pageSize": 20,
    "total": 100,
    "items": [ ... ]
  }
}
```

---

## ğŸ” AUTHENTICATION & AUTHORIZATION

### **JWT Token**

- **Format:** `Bearer <token>`
- **Header:** `Authorization: Bearer <token>`
- **Payload:** `{ userId, email, role }`
- **Expiry:** 1 ngÃ y
- **Secret:** `JWT_SECRET` (tá»« .env)

### **Roles**

- **`user`:** NgÆ°á»i dÃ¹ng thÃ´ng thÆ°á»ng
- **`admin`:** Quáº£n trá»‹ viÃªn

### **Protected Routes**

- Routes yÃªu cáº§u authentication: ThÃªm middleware `auth`
- Routes yÃªu cáº§u admin: ThÃªm middleware `auth` + `isAdmin`

---

## ğŸŒ ENVIRONMENT VARIABLES

### **Backend (.env)**

```env
# Database
DB_USER=sa
DB_PASS=password
DB_HOST=localhost
DB_NAME=exterior_ai
DB_PORT=1433
DB_AUTH=sql  # hoáº·c "windows"
DB_DOMAIN=DOMAIN  # Náº¿u dÃ¹ng Windows Auth

# JWT
JWT_SECRET=your-secret-key

# Cloudinary
CLOUDINARY_URL=cloudinary://api_key:api_secret@cloud_name

# Google Gemini AI
GOOGLE_API_KEY=your-gemini-api-key
GOOGLE_API_KEY1=your-gemini-api-key-for-image-generation
GOOGLE_GEMINI_MODEL=gemini-2.5-flash-image

# Stability AI
STABILITY_AI_API_KEY=your-stability-api-key
STABILITY_AI_ENGINE=stable-diffusion-xl-1024-v1-0

# Replicate
REPLICATE_API_TOKEN=your-replicate-token
REPLICATE_MODEL=stability-ai/sdxl:...

# Hugging Face
HUGGINGFACE_API_KEY=your-huggingface-key
HUGGINGFACE_MODEL=stabilityai/stable-diffusion-xl-base-1.0

# Admin Seeder
DEFAULT_ADMIN_EMAIL=admin@ngoai-that.ai
DEFAULT_ADMIN_PASSWORD=Admin@123456

# Server
PORT=8000
```

### **Frontend (.env)**

```env
VITE_API_URL=http://localhost:8000
```

---

## ğŸš€ QUY TRÃŒNH WIZARD FLOW

1. **BÆ°á»›c 1: Upload Sample** (`POST /api/upload-sample`)

   - User upload áº£nh máº«u
   - AI phÃ¢n tÃ­ch áº£nh máº«u (Gemini)
   - Tráº£ vá» `tempId` vÃ  phÃ¢n tÃ­ch

2. **BÆ°á»›c 2: Select Requirements** (`POST /api/generate-style`)

   - User chá»n/nháº­p yÃªu cáº§u thiáº¿t káº¿
   - LÆ°u vÃ o session vá»›i `tempId`

3. **BÆ°á»›c 3: Upload House** (`POST /api/generate-final`)

   - User upload áº£nh nhÃ  tháº­t
   - AI sinh áº£nh káº¿t quáº£ tá»« nhiá»u services
   - LÆ°u vÃ o database (Generations table)

4. **BÆ°á»›c 4: Result**
   - Hiá»ƒn thá»‹ áº£nh káº¿t quáº£
   - User cÃ³ thá»ƒ xem láº¡i trong History

---

## ğŸ“ GHI CHÃš CHO DEV/TESTER/BA Má»šI

### **Cho Developer:**

1. **Database Connection:**

   - Há»‡ thá»‘ng há»— trá»£ cáº£ SQL Auth vÃ  Windows Auth
   - Kiá»ƒm tra `.env` Ä‘á»ƒ cáº¥u hÃ¬nh Ä‘Ãºng
   - Cháº¡y `testDb()` Ä‘á»ƒ kiá»ƒm tra káº¿t ná»‘i

2. **AI Services:**

   - Há»‡ thá»‘ng tá»± Ä‘á»™ng fallback giá»¯a cÃ¡c services
   - Æ¯u tiÃªn: Gemini â†’ Stability AI â†’ Replicate â†’ HuggingFace
   - Cáº§n cáº¥u hÃ¬nh Ã­t nháº¥t 1 API key Ä‘á»ƒ há»‡ thá»‘ng hoáº¡t Ä‘á»™ng

3. **Session Management:**

   - Wizard sá»­ dá»¥ng in-memory Map (`SESS`) Ä‘á»ƒ lÆ°u temp data
   - `tempId` lÃ  UUID, chá»‰ tá»“n táº¡i trong session hiá»‡n táº¡i
   - KhÃ´ng persist vÃ o database cho Ä‘áº¿n khi `generate-final`

4. **File Upload:**

   - Sá»­ dá»¥ng `multer` vá»›i `memoryStorage`
   - Upload lÃªn Cloudinary báº±ng stream
   - KhÃ´ng lÆ°u file táº¡m trÃªn server

5. **Error Handling:**
   - Sá»­ dá»¥ng `asyncHandler` Ä‘á»ƒ bá»c async routes
   - Global error handler á»Ÿ `error.js`
   - LuÃ´n tráº£ vá» format `{ ok: true/false, ... }`

### **Cho Tester:**

1. **Test Flow:**

   - Test tá»«ng bÆ°á»›c wizard theo thá»© tá»±
   - Kiá»ƒm tra `tempId` Ä‘Æ°á»£c giá»¯ nguyÃªn qua cÃ¡c bÆ°á»›c
   - Test vá»›i cÃ¡c loáº¡i áº£nh khÃ¡c nhau (JPEG, PNG, ...)

2. **Authentication:**

   - Test vá»›i token há»£p lá»‡
   - Test vá»›i token háº¿t háº¡n
   - Test vá»›i token khÃ´ng há»£p lá»‡
   - Test vá»›i thiáº¿u token

3. **Authorization:**

   - Test admin routes vá»›i user thÆ°á»ng (pháº£i tráº£ 403)
   - Test admin routes vá»›i admin (pháº£i thÃ nh cÃ´ng)

4. **Edge Cases:**
   - Upload file quÃ¡ lá»›n
   - Upload file khÃ´ng pháº£i áº£nh
   - API key khÃ´ng há»£p lá»‡
   - Database connection fail

### **Cho Business Analyst:**

1. **User Flow:**

   - User Ä‘Äƒng kÃ½ â†’ ÄÄƒng nháº­p â†’ Upload áº£nh máº«u â†’ Chá»n yÃªu cáº§u â†’ Upload áº£nh nhÃ  â†’ Nháº­n káº¿t quáº£

2. **Admin Flow:**

   - Admin Ä‘Äƒng nháº­p â†’ Xem thá»‘ng kÃª â†’ Quáº£n lÃ½ users â†’ Xem/quáº£n lÃ½ generations

3. **Business Rules:**

   - Má»—i user chá»‰ xem Ä‘Æ°á»£c lá»‹ch sá»­ cá»§a mÃ¬nh (trá»« admin)
   - Admin cÃ³ thá»ƒ xem táº¥t cáº£ vÃ  xÃ³a báº¥t ká»³ generation nÃ o
   - áº¢nh Ä‘Æ°á»£c lÆ°u trÃªn Cloudinary, khÃ´ng lÆ°u trÃªn server

4. **Performance:**
   - AI generation cÃ³ thá»ƒ máº¥t 10-60 giÃ¢y tÃ¹y service
   - Há»‡ thá»‘ng tá»± Ä‘á»™ng retry vá»›i service khÃ¡c náº¿u service Ä‘áº§u fail

---

## ğŸ” DEBUGGING TIPS

1. **Check Logs:**

   - Backend logs: Console output (morgan + activityLogger)
   - Frontend logs: Browser console

2. **Database:**

   - Kiá»ƒm tra connection: `GET /health`
   - Kiá»ƒm tra tables: `SELECT * FROM Users`, `SELECT * FROM Generations`

3. **AI Services:**

   - Kiá»ƒm tra API keys trong `.env`
   - Xem logs console Ä‘á»ƒ biáº¿t service nÃ o Ä‘ang Ä‘Æ°á»£c dÃ¹ng
   - Test tá»«ng service riÃªng láº» náº¿u cáº§n

4. **File Upload:**
   - Kiá»ƒm tra Cloudinary credentials
   - Kiá»ƒm tra file size limits
   - Kiá»ƒm tra MIME types Ä‘Æ°á»£c cháº¥p nháº­n

---

## ğŸ¨ PHÃ‚N TÃCH GIAO DIá»†N & LUá»’NG NGÆ¯á»œI DÃ™NG (FRONTEND)

### **Kiáº¿n trÃºc Frontend**

#### **1. Entry Point & Routing**

- **File:** `frontend/src/App.jsx`
- **Chá»©c nÄƒng:** Component chÃ­nh quáº£n lÃ½ toÃ n bá»™ routing vÃ  state cá»§a á»©ng dá»¥ng
- **State Management:**
  - `user` - ThÃ´ng tin user hiá»‡n táº¡i (lÆ°u trong localStorage)
  - `activeView` - View hiá»‡n táº¡i: `"wizard"`, `"profile"`, `"history"`, `"admin-area"`
  - `authMode` - Mode Ä‘Äƒng nháº­p: `"login"` hoáº·c `"register"`
  - `isAdminArea` - Flag cho biáº¿t Ä‘ang á»Ÿ khu vá»±c admin

#### **2. Authentication Flow**

```
ChÆ°a Ä‘Äƒng nháº­p â†’ LoginPage/RegisterPage
    â†“ (ÄÄƒng nháº­p thÃ nh cÃ´ng)
ÄÃ£ Ä‘Äƒng nháº­p â†’ App Shell (Header + Main + Footer)
    â†“
Chá»n view: Wizard / Profile / Admin (náº¿u lÃ  admin)
```

#### **3. Wizard Flow (4 BÆ°á»›c)**

**BÆ°á»›c 1: Upload Sample** (`UploadSampleStep.jsx`)

- **Chá»©c nÄƒng:** Upload áº£nh máº«u vÃ  phÃ¢n tÃ­ch báº±ng AI
- **UI Elements:**
  - Drag & drop zone
  - File input button
  - Preview áº£nh Ä‘Ã£ chá»n
  - Loading spinner khi Ä‘ang upload
  - Alert message tá»« API
- **State:** `wizardData.sampleImage`, `loadingState.sample`
- **API Call:** `POST /api/upload-sample`
- **Káº¿t quáº£:** Nháº­n `tempId` vÃ  `aiSummary`

**BÆ°á»›c 2: Select Requirements** (`SelectRequirementsStep.jsx`)

- **Chá»©c nÄƒng:** Chá»n phong cÃ¡ch vÃ  nháº­p yÃªu cáº§u chi tiáº¿t
- **UI Elements:**
  - Grid cÃ¡c phong cÃ¡ch (7 options): Hiá»‡n Ä‘áº¡i, TÃ¢n cá»• Ä‘iá»ƒn, Scandinavian, Resort nhiá»‡t Ä‘á»›i, Sang trá»ng Ä‘áº³ng cáº¥p, Tá»‘i giáº£n Ä‘Æ°Æ¡ng Ä‘áº¡i, KhÃ´ng chá»n
  - Textarea cho báº£ng mÃ u mong muá»‘n
  - Textarea cho váº­t liá»‡u & trang trÃ­
  - Textarea cho ghi chÃº AI
  - Hiá»ƒn thá»‹ káº¿ hoáº¡ch gá»£i Ã½ tá»« AI (náº¿u cÃ³)
- **State:** `wizardData.requirements`, `wizardData.stylePlan`
- **API Call:** `POST /api/generate-style`
- **Validation:** Pháº£i cÃ³ Ã­t nháº¥t 1 trÆ°á»ng Ä‘Æ°á»£c Ä‘iá»n

**BÆ°á»›c 3: Upload House** (`UploadHouseStep.jsx`)

- **Chá»©c nÄƒng:** Upload áº£nh nhÃ  tháº­t vÃ  táº¡o áº£nh káº¿t quáº£
- **UI Elements:**
  - Drag & drop zone cho áº£nh nhÃ 
  - Preview áº£nh nhÃ  Ä‘Ã£ chá»n
  - TÃ³m táº¯t yÃªu cáº§u (phong cÃ¡ch, báº£ng mÃ u, váº­t liá»‡u, ghi chÃº)
  - Preview áº£nh máº«u tham chiáº¿u (náº¿u cÃ³)
  - Loading spinner khi Ä‘ang generate
- **State:** `wizardData.houseImage`, `loadingState.house`
- **API Call:** `POST /api/generate-final` (cáº§n JWT token)
- **Káº¿t quáº£:** Nháº­n `outputImages` (single, stability, replicate, huggingface)

**BÆ°á»›c 4: Result** (`ResultStep.jsx`)

- **Chá»©c nÄƒng:** Hiá»ƒn thá»‹ káº¿t quáº£ vÃ  lÆ°u vÃ o lá»‹ch sá»­
- **UI Elements:**
  - Grid 4 cards:
    - ThÃ´ng tin tá»•ng quan (phong cÃ¡ch, báº£ng mÃ u, Ä‘iá»ƒm nháº¥n, ghi chÃº AI)
    - áº¢nh káº¿t quáº£ (Æ°u tiÃªn: single > outputImage > stability > replicate > huggingface)
    - áº¢nh máº«u tham chiáº¿u
    - áº¢nh hiá»‡n tráº¡ng
  - Textarea ghi chÃº bá»• sung
  - Button "LÆ°u vÃ o lá»‹ch sá»­"
  - Button "Báº¯t Ä‘áº§u dá»± Ã¡n má»›i"
  - Danh sÃ¡ch lá»‹ch sá»­ Ä‘Ã£ lÆ°u (hiá»ƒn thá»‹ ngay trong step nÃ y)
- **State:** `wizardData.result`, `wizardData.outputImage`
- **Actions:** `onSaveHistory()`, `onDeleteHistory()`, `onRestart()`

#### **4. Navigation Structure**

**Header Navigation:**

- **Logo & Brand:** "AI House Designer"
- **User Avatar:** Hiá»ƒn thá»‹ initials + role badge
- **Nav Items:**
  - "Quy trÃ¬nh" (wizard) - Máº·c Ä‘á»‹nh
  - "Há»“ sÆ¡" (profile)
  - "Quáº£n trá»‹" (admin-area) - Chá»‰ hiá»ƒn thá»‹ náº¿u `user.role === "admin"`
- **Logout Button**

**Step Progress Bar:**

- Hiá»ƒn thá»‹ 4 bÆ°á»›c vá»›i icon vÃ  label
- Progress bar fill theo `progressPercent`
- Active step Ä‘Æ°á»£c highlight
- Completed steps cÃ³ checkmark

**Wizard Navigation:**

- `WizardNavigation.jsx` - Component Ä‘iá»u hÆ°á»›ng giá»¯a cÃ¡c bÆ°á»›c
- Buttons: "Quay láº¡i" (back), "Tiáº¿p tá»¥c" (next)
- Disable logic dá»±a trÃªn state cá»§a tá»«ng step

#### **5. State Management Patterns**

**Custom Hooks:**

**`useWizardFlow.js`**

- Quáº£n lÃ½ toÃ n bá»™ state vÃ  logic cá»§a wizard
- **State:**
  - `wizardData` - Data qua cÃ¡c bÆ°á»›c (sampleImage, requirements, houseImage, result, tempId)
  - `loadingState` - Loading state cho tá»«ng step
  - `apiMessages` - Messages tá»« API responses
  - `stepIndex` - Index cá»§a step hiá»‡n táº¡i (0-3)
- **Actions:**
  - `handleSampleSelected()` - Upload vÃ  phÃ¢n tÃ­ch áº£nh máº«u
  - `handleRequirementsChange()` - Update requirements
  - `handleGenerateStyle()` - Gá»­i yÃªu cáº§u phong cÃ¡ch
  - `handleHouseSelected()` - Chá»n áº£nh nhÃ 
  - `handleGenerateFinal()` - Generate áº£nh káº¿t quáº£
  - `goNext()`, `goBack()`, `resetWizard()`

**`useHistoryManager.js`**

- Quáº£n lÃ½ lá»‹ch sá»­ sinh áº£nh
- **State:** `history`, `visibleHistory`, `personalHistory`
- **Actions:** `saveHistory()`, `updateHistoryStatus()`, `deleteHistoryEntry()`

**`useToasts.js`**

- Quáº£n lÃ½ toast notifications
- **State:** `toasts` array
- **Actions:** `pushToast()`, `dismissToast()`

**`useAdminUsers.js`**

- Quáº£n lÃ½ users trong admin area
- Fetch, paginate, filter users

#### **6. Component Hierarchy**

```
App.jsx
â”œâ”€â”€ ToastList (Global notifications)
â”œâ”€â”€ Header
â”‚   â”œâ”€â”€ Logo & Brand
â”‚   â”œâ”€â”€ User Avatar & Info
â”‚   â”œâ”€â”€ Navigation (Wizard/Profile/Admin)
â”‚   â””â”€â”€ Logout Button
â”œâ”€â”€ Main Content
â”‚   â”œâ”€â”€ Step Progress Bar (chá»‰ hiá»ƒn thá»‹ khi activeView === "wizard")
â”‚   â””â”€â”€ Active View:
â”‚       â”œâ”€â”€ Wizard Flow (4 steps)
â”‚       â”‚   â”œâ”€â”€ UploadSampleStep
â”‚       â”‚   â”œâ”€â”€ SelectRequirementsStep
â”‚       â”‚   â”œâ”€â”€ UploadHouseStep
â”‚       â”‚   â””â”€â”€ ResultStep
â”‚       â”œâ”€â”€ HistoryViewer (activeView === "history")
â”‚       â”œâ”€â”€ ProfilePage (activeView === "profile")
â”‚       â””â”€â”€ AdminLayout (isAdminArea === true)
â”‚           â”œâ”€â”€ AdminDashboard
â”‚           â”œâ”€â”€ AdminUserManagement
â”‚           â”œâ”€â”€ AdminLibraryManager  [Má»šI] - Quáº£n lÃ½ thÆ° viá»‡n vÃ¹ng miá»n
â”‚           â””â”€â”€ AdminDashboardPage
â””â”€â”€ Footer
```

**AdminLibraryManager.jsx** - [Má»šI]

- **Vai trÃ²:** Component quáº£n lÃ½ thÆ° viá»‡n máº«u nhÃ  vÃ¹ng miá»n
- **Chá»©c nÄƒng:**
  - CRUD máº«u nhÃ : ThÃªm, sá»­a, xÃ³a máº«u nhÃ  trong thÆ° viá»‡n
  - Upload áº£nh máº«u nhÃ  lÃªn Cloudinary
  - Quáº£n lÃ½ theo 4 vÃ¹ng miá»n: Báº¯c, Trung, Nam, Ã‚u
  - Nháº­p StyleData (JSON) mÃ´ táº£ Ä‘áº·c Ä‘iá»ƒm kiáº¿n trÃºc
- **State:**
  - `items` - Danh sÃ¡ch máº«u nhÃ 
  - `loading` - Tráº¡ng thÃ¡i loading
  - `editingItem` - Item Ä‘ang chá»‰nh sá»­a
  - `formData` - Dá»¯ liá»‡u form nháº­p
- **Actions:**
  - `loadLibrary()` - Táº£i danh sÃ¡ch thÆ° viá»‡n
  - `handleSubmit()` - Xá»­ lÃ½ thÃªm/cáº­p nháº­t
  - `handleDelete()` - Xá»­ lÃ½ xÃ³a
  - `handleEdit()` - Báº¯t Ä‘áº§u chá»‰nh sá»­a
  - `handleFileChange()` - Xá»­ lÃ½ chá»n file áº£nh

#### **7. UI/UX Features**

**Responsive Design:**

- Header collapse khi scroll xuá»‘ng (tá»« 160px)
- Quick menu toggle khi header collapsed
- Grid layouts tá»± Ä‘á»™ng responsive

**Loading States:**

- Spinner cho má»—i step khi Ä‘ang xá»­ lÃ½
- Disable buttons khi loading
- Progress messages rÃµ rÃ ng

**Error Handling:**

- Toast notifications cho errors
- Alert messages trong tá»«ng step
- Fallback UI khi khÃ´ng cÃ³ data

**Image Handling:**

- Preview vá»›i `URL.createObjectURL()`
- Cleanup vá»›i `URL.revokeObjectURL()` khi unmount
- Fallback images náº¿u URL khÃ´ng há»£p lá»‡
- Data URL encoding Ä‘á»ƒ lÆ°u vÃ o history

**Accessibility:**

- ARIA labels cho navigation
- Role attributes cho tables
- Keyboard navigation support
- Screen reader friendly

#### **8. Data Flow**

**Wizard Data Flow:**

```
User selects sample image
  â†’ handleSampleSelected()
  â†’ uploadSample() API call
  â†’ Response: { tempId, aiSummary, sampleImageUrl }
  â†’ Update wizardData.sampleImage
  â†’ goNext() â†’ Step 2

User selects requirements
  â†’ handleRequirementsChange()
  â†’ Update wizardData.requirements
  â†’ handleGenerateStyle()
  â†’ generateStyle() API call
  â†’ Response: { message, plan }
  â†’ Update wizardData.stylePlan
  â†’ goNext() â†’ Step 3

User selects house image
  â†’ handleHouseSelected()
  â†’ Update wizardData.houseImage
  â†’ handleGenerateFinal()
  â†’ generateFinal() API call (vá»›i JWT token)
  â†’ Response: { outputImages, outputImage }
  â†’ Update wizardData.result
  â†’ goNext() â†’ Step 4

User saves to history
  â†’ onSaveHistory()
  â†’ saveHistory() tá»« useHistoryManager
  â†’ LÆ°u vÃ o localStorage + cÃ³ thá»ƒ sync vá»›i backend
```

**Authentication Flow:**

```
App loads
  â†’ Check localStorage for "exteriorUser"
  â†’ If exists: setUser(parsed)
  â†’ If not: Show LoginPage

User logs in
  â†’ handleLogin()
  â†’ loginUser() API call
  â†’ Response: { token, user }
  â†’ setUser({ id, email, role, token })
  â†’ Save to localStorage
  â†’ Redirect to wizard

User logs out
  â†’ handleLogout()
  â†’ Clear localStorage
  â†’ setUser(null)
  â†’ Reset wizard
  â†’ Show LoginPage
```

#### **9. Admin Area**

**AdminLayout.jsx:**

- Layout riÃªng cho admin
- Navigation: Dashboard, Users, Generations
- Exit button Ä‘á»ƒ quay vá» user area

**AdminDashboard.jsx:**

- Thá»‘ng kÃª tá»•ng quan (3 stat tiles)
- Báº£ng thá»‘ng kÃª theo tÃ i khoáº£n
- Hoáº¡t Ä‘á»™ng ná»•i báº­t (5 má»¥c má»›i nháº¥t)
- Chi tiáº¿t lá»‹ch sá»­ theo user Ä‘Ã£ chá»n
- Pagination controls

**AdminUserManagement.jsx:**

- CRUD users
- Filter vÃ  search
- Role management

#### **10. Styling & Theming**

**Tailwind CSS:**

- Utility-first CSS framework
- Custom classes trong `index.css`
- Dark theme vá»›i gradient backgrounds
- Consistent spacing vÃ  typography

**Component Classes:**

- `wizard-card__section` - Container cho má»—i section
- `upload-dropzone` - Drag & drop zone
- `info-card` - Card hiá»ƒn thá»‹ thÃ´ng tin
- `btn btn-primary` / `btn btn-secondary` - Buttons
- `alert info` - Alert messages
- `admin-*` - Admin-specific classes

#### **11. Performance Optimizations**

**Image Handling:**

- Lazy loading cho images
- Object URL cleanup Ä‘á»ƒ trÃ¡nh memory leaks
- Data URL encoding chá»‰ khi cáº§n lÆ°u vÃ o history

**State Updates:**

- `useCallback` cho event handlers
- `useMemo` cho computed values
- Conditional rendering Ä‘á»ƒ trÃ¡nh re-render khÃ´ng cáº§n thiáº¿t

**API Calls:**

- Error handling vá»›i try-catch
- Loading states Ä‘á»ƒ UX tá»‘t hÆ¡n
- Toast notifications cho feedback

---

## ğŸ“š TÃ€I LIá»†U THAM KHáº¢O

- [Express.js Documentation](https://expressjs.com/)
- [SQL Server mssql Driver](https://github.com/tediousjs/node-mssql)
- [Cloudinary Documentation](https://cloudinary.com/documentation)
- [Google Gemini AI](https://ai.google.dev/)
- [React Documentation](https://react.dev/)
- [Vite Documentation](https://vitejs.dev/)

---

**Cáº­p nháº­t láº§n cuá»‘i:** 2026-01-12  
**PhiÃªn báº£n:** 1.1.0

### Changelog v1.1.0:
- ThÃªm báº£ng `RegionalLibrary` cho thÆ° viá»‡n máº«u nhÃ  vÃ¹ng miá»n
- ThÃªm báº£ng `ElementMenh` (dá»± kiáº¿n) cho cáº¥u hÃ¬nh ngÅ© hÃ nh
- ThÃªm API routes cho quáº£n lÃ½ thÆ° viá»‡n (`/api/library/*`, `/api/admin/library/*`)
- ThÃªm component `AdminLibraryManager.jsx` cho Admin quáº£n lÃ½ thÆ° viá»‡n
- ThÃªm cÃ¡c functions trong `api/admin.js` cho Library Management
- Cáº­p nháº­t cáº¥u trÃºc thÆ° má»¥c vá»›i cÃ¡c file má»›i

